Parameters:                                                                                                                                                                                                                    
                                                                                                                                                                                                                               
  LinuxAmiId:                                                                                                                                                                                                                   
    Type: AWS::SSM::Parameter::Value<AWS::EC2::Image::Id>                                                                                                                                                                        
    Default: /aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2                                                                                                                                                       
                                                                                                                                                                                                                               
Resources:                                                                                                                                                                                                                     
                                                                                                                                                                                                                               
  LabVpc:                                                                                                                                                                                                                       
    Type: AWS::EC2::VPC                                                                                                                                                                                                          
    Properties:                                                                                                                                                                                                                  
      CidrBlock: 10.0.0.0/16                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      Tags:                                                                                                                                                                                                                       
        - Key: Name                                                                                                                                                                                                                
          Value: LabVpc                                                                                                                                                                                                           
                                                                                                                                                                                                                               
  IGW:                                                                                                                                                                                                                          
    Type: AWS::EC2::InternetGateway                                                                                                                                                                                              
                                                                                                                                                                                                                               
  VPCtoIGWConnection:                                                                                                                                                                                                           
    Type: AWS::EC2::VPCGatewayAttachment                                                                                                                                                                                         
    Properties: 
      VpcId: !Ref LabVpc                                                                                                                                                                                                                 
      InternetGatewayId: !Ref IGW                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                               
  PrivateSubnet:                                                                                                                                                                                                                
    Type: AWS::EC2::Subnet                                                                                                                                                                                                       
    Properties:                                                                                                                                                                                                                  
      VpcId: !Ref LabVpc                                                                                                                                                                                                          
      CidrBlock: 10.0.2.0/24                                                                                                                                                                                                      
      AvailabilityZone: !Select                                                                                                                                                                                                   
        - 0                                                                                                                                                                                                                        
        - !GetAZs                                                                                                                                                                                                                                                                                                                                                                                                                            
      Tags:                                                                                                                                                                                                                       
        - Key: Name                                                                                                                                                                                                                
          Value: Private Subnet                                                                                                                                                                                                    
                                                                                                                                                                                                                               
  SecurityGroup:                                                                                                                                                                                                                
    Type: AWS::EC2::SecurityGroup                                                                                                                                                                                                
    Properties:
      GroupDescription: SSH                                                                                                                                                                                                                                                                                                                                                                                                               
      VpcId: !Ref LabVpc                                                                                                                                                                                                          
      SecurityGroupIngress:                                                                                                                                                                                                       
        - IpProtocol: tcp                                                                                                                                                                                                          
          FromPort: 22                                                                                                                                                                                                             
          ToPort: 22                                                                                                                                                                                                               
          CidrIp: 0.0.0.0/0                                                                                                                                                                                                        
                                                                                                                                                                                                                               
  MyInstance:                                                                                                                                                                                                                  
    Type: AWS::EC2::Instance                                                                                                                                                                                                     
    Properties:                                                                                                                                                                                                                  
      ImageId: !Ref LinuxAmiId                                                                                                                                                                                                    
      InstanceType: t3.micro                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      NetworkInterfaces:   
        - DeviceIndex: 0                                                                                                                                 
          AssociatePublicIpAddress: true                                                                                                                 
          SubnetId: !Ref PrivateSubnet                                                                                                                   
          GroupSet:                                                                                                                                      
            - !Ref SecurityGroup                                                                                                                            
      Tags:                                                                                                                                             
        - Key: Name                                                                                                                                      
          Value: MyInstance